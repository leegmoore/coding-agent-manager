From c83ec00c9a7ed089923cd6a6a890df208f9913c4 Mon Sep 17 00:00:00 2001
From: leegmoore <lee.g.moore@gmail.com>
Date: Fri, 26 Dec 2025 19:03:37 -0500
Subject: [PATCH] feat: Compression timing, model updates, and config changes
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- Add durationMs timing to compression tasks
- Add total/avg timing to compression stats and debug log
- Change default model to Gemini 2.5 Flash (no thinking)
- Use Opus 4.5 with extended thinking for messages >500 tokens
- Add step-by-step quality check prompt for large messages
- Raise min token threshold from 30 to 50
- Switch to port 4010, remove pm2 staging setup
- Add --env-file to dev script

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
---
 CLAUDE.md                                | 26 ++-------
 package.json                             |  9 +--
 patches/012-fix-pm2-cwd.patch            | 70 ++++++++++++++++++++++++
 setup-cam-proj.md                        | 10 ++--
 src/config.ts                            |  4 +-
 src/providers/openrouter-provider.ts     | 58 +++++++++++++++++---
 src/server.ts                            |  1 +
 src/services/compression-batch.ts        |  6 +-
 src/services/compression-debug-logger.ts | 25 ++++++++-
 src/services/compression.ts              |  9 +++
 src/types.ts                             |  3 +
 11 files changed, 171 insertions(+), 50 deletions(-)
 create mode 100644 patches/012-fix-pm2-cwd.patch

diff --git a/CLAUDE.md b/CLAUDE.md
index c1e0333..bec9a9b 100644
--- a/CLAUDE.md
+++ b/CLAUDE.md
@@ -7,7 +7,7 @@ A utility for managing Claude Code and GitHub Copilot session files. Provides to
 ```
 src/
 â”œâ”€â”€ server.ts              # Express entry point
-â”œâ”€â”€ config.ts              # Environment configuration (port 7331)
+â”œâ”€â”€ config.ts              # Environment configuration (port 4010)
 â”œâ”€â”€ types.ts               # TypeScript interfaces
 â”œâ”€â”€ errors.ts              # Custom error classes
 â”œâ”€â”€ lib/                   # Core utilities
@@ -35,33 +35,15 @@ views/pages/               # EJS templates
 
 ## Running the Service
 
-The service runs on **port 7331** by default.
+The service runs on **port 4010** by default.
 
-### Development (with hot reload)
 ```bash
 npm run dev
 ```
 
-### Production (via pm2)
-```bash
-npm run build              # Compile TypeScript to dist/
-npm run serve              # Start via pm2
-npm run serve:stop         # Stop the service
-npm run serve:restart      # Restart after rebuild
-npm run serve:status       # Check if running
-npm run serve:logs         # Tail logs
-```
-
-### macOS: Auto-start on boot
-```bash
-npm run serve              # Start the process first
-pm2 save                   # Save current process list
-pm2 startup                # Generates a command - run it with sudo
-```
-
 ## Web UI
 
-Access the web interface at `http://localhost:7331`:
+Access the web interface at `http://localhost:4010`:
 - **Session Browser** (`/`) - Browse and manage sessions
 - **Clone** (`/session-clone`) - Clone with removal/compression options
 - **Visualize** (`/session-detail`) - Turn-by-turn session visualization
@@ -85,7 +67,7 @@ Show this command to the user. They must exit the current session and run that c
 
 For more control (custom removal percentages, compression):
 
-1. Open the Session Browser at `http://localhost:7331`
+1. Open the Session Browser at `http://localhost:4010`
 2. Select a project and find the session
 3. Click **Clone**
 4. Configure removal options
diff --git a/package.json b/package.json
index b612df4..bfbc70d 100644
--- a/package.json
+++ b/package.json
@@ -4,18 +4,13 @@
   "type": "module",
   "main": "dist/server.js",
   "scripts": {
-    "dev": "tsx watch src/server.ts",
+    "dev": "tsx watch --env-file=.env.local src/server.ts",
     "build": "tsc",
     "start": "node dist/server.js",
     "test": "vitest run",
     "test:watch": "vitest",
     "typecheck": "tsc --noEmit",
-    "serve": "pm2 start dist/server.js --name coding-agent-manager --cwd \"$(pwd)\" --node-args='--env-file=.env.local'",
-    "serve:stop": "pm2 stop coding-agent-manager",
-    "serve:restart": "pm2 restart coding-agent-manager --update-env",
-    "serve:status": "pm2 status coding-agent-manager",
-    "serve:logs": "pm2 logs coding-agent-manager",
-    "quick-clean": "curl -s -X POST http://localhost:7331/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'$npm_config_id'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\"",
+    "quick-clean": "curl -s -X POST http://localhost:4010/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'$npm_config_id'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\"",
     "export-snapshots": "node scripts/export-repo-snapshots.js",
     "c7:search": "f() { curl -s \"https://context7.com/api/v2/search?query=$1\" -H \"Authorization: Bearer $CONTEXT7_API_KEY\" | jq '.results[:5] | .[] | {id, title, description}'; }; f",
     "c7:docs": "f() { curl -s \"https://context7.com/api/v2/docs/code/$1${2:+?topic=$2}\" -H \"Authorization: Bearer $CONTEXT7_API_KEY\"; }; f",
diff --git a/patches/012-fix-pm2-cwd.patch b/patches/012-fix-pm2-cwd.patch
new file mode 100644
index 0000000..088496d
--- /dev/null
+++ b/patches/012-fix-pm2-cwd.patch
@@ -0,0 +1,70 @@
+From 91f2f98f5d2ce5a41ef1be65c452aa77b47a9c41 Mon Sep 17 00:00:00 2001
+From: leegmoore <lee.g.moore@gmail.com>
+Date: Mon, 22 Dec 2025 15:25:22 -0500
+Subject: [PATCH] fix: Add --cwd to pm2 serve for correct env file path
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
+
+Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
+---
+ package.json                                  |  2 +-
+ .../011-fix-serve-restart-update-env.patch    | 31 +++++++++++++++++++
+ 2 files changed, 32 insertions(+), 1 deletion(-)
+ create mode 100644 patches/011-fix-serve-restart-update-env.patch
+
+diff --git a/package.json b/package.json
+index 90f7191..b612df4 100644
+--- a/package.json
++++ b/package.json
+@@ -10,7 +10,7 @@
+     "test": "vitest run",
+     "test:watch": "vitest",
+     "typecheck": "tsc --noEmit",
+-    "serve": "pm2 start dist/server.js --name coding-agent-manager --node-args='--env-file=.env.local'",
++    "serve": "pm2 start dist/server.js --name coding-agent-manager --cwd \"$(pwd)\" --node-args='--env-file=.env.local'",
+     "serve:stop": "pm2 stop coding-agent-manager",
+     "serve:restart": "pm2 restart coding-agent-manager --update-env",
+     "serve:status": "pm2 status coding-agent-manager",
+diff --git a/patches/011-fix-serve-restart-update-env.patch b/patches/011-fix-serve-restart-update-env.patch
+new file mode 100644
+index 0000000..88d28e9
+--- /dev/null
++++ b/patches/011-fix-serve-restart-update-env.patch
+@@ -0,0 +1,31 @@
++From ba1dcf90482bfcb3265beaa225903dd90a308c44 Mon Sep 17 00:00:00 2001
++From: leegmoore <lee.g.moore@gmail.com>
++Date: Mon, 22 Dec 2025 15:22:00 -0500
++Subject: [PATCH] fix: Add --update-env to serve:restart script
++MIME-Version: 1.0
++Content-Type: text/plain; charset=UTF-8
++Content-Transfer-Encoding: 8bit
++
++ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
++
++Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
++---
++ package.json | 2 +-
++ 1 file changed, 1 insertion(+), 1 deletion(-)
++
++diff --git a/package.json b/package.json
++index d3450ac..90f7191 100644
++--- a/package.json
+++++ b/package.json
++@@ -12,7 +12,7 @@
++     "typecheck": "tsc --noEmit",
++     "serve": "pm2 start dist/server.js --name coding-agent-manager --node-args='--env-file=.env.local'",
++     "serve:stop": "pm2 stop coding-agent-manager",
++-    "serve:restart": "pm2 restart coding-agent-manager",
+++    "serve:restart": "pm2 restart coding-agent-manager --update-env",
++     "serve:status": "pm2 status coding-agent-manager",
++     "serve:logs": "pm2 logs coding-agent-manager",
++     "quick-clean": "curl -s -X POST http://localhost:7331/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'$npm_config_id'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\"",
++-- 
++2.49.0
++
+-- 
+2.49.0
+
diff --git a/setup-cam-proj.md b/setup-cam-proj.md
index 53182d9..aa58ca8 100644
--- a/setup-cam-proj.md
+++ b/setup-cam-proj.md
@@ -6,7 +6,7 @@ Give this to a Claude agent in any project to set up access to the context clean
 
 ## Setup Instructions
 
-Add the following to this project to enable quick context cleaning via the Coding Agent Manager service running on port 7331.
+Add the following to this project to enable quick context cleaning via the Coding Agent Manager service running on port 4010.
 
 ### 1. Add to package.json
 
@@ -14,7 +14,7 @@ Add the following to this project to enable quick context cleaning via the Codin
 ```json
 {
   "scripts": {
-    "quick-clean": "curl -s -X POST http://localhost:7331/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'$npm_config_id'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\""
+    "quick-clean": "curl -s -X POST http://localhost:4010/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'$npm_config_id'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\""
   }
 }
 ```
@@ -23,7 +23,7 @@ Add the following to this project to enable quick context cleaning via the Codin
 ```json
 {
   "scripts": {
-    "quick-clean": "curl -s -X POST http://localhost:7331/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'\"$1\"'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\""
+    "quick-clean": "curl -s -X POST http://localhost:4010/api/v2/clone -H 'Content-Type: application/json' -d '{\"sessionId\":\"'\"$1\"'\",\"toolRemoval\":\"100\",\"thinkingRemoval\":\"100\"}' | node -e \"const d=JSON.parse(require('fs').readFileSync(0,'utf8')); if(d.success){const id=d.outputPath.split('/').pop().replace('.jsonl',''); console.log('claude --dangerously-skip-permissions --resume '+id)}else{console.log('Error: '+(d.error||'unknown'))}\""
   }
 }
 ```
@@ -74,7 +74,7 @@ Run the quick-clean script with their session ID and show them the resume comman
 
 **"Session not found"** - Check the session GUID is correct.
 
-**Service location:** The CAM service should be running on `http://localhost:7331`. Verify with:
+**Service location:** The CAM service should be running on `http://localhost:4010`. Verify with:
 ```bash
-curl http://localhost:7331/health
+curl http://localhost:4010/health
 ```
diff --git a/src/config.ts b/src/config.ts
index 2ad519a..bc937b5 100644
--- a/src/config.ts
+++ b/src/config.ts
@@ -6,7 +6,7 @@ export const config = {
   get claudeDir() {
     return process.env.CLAUDE_DIR || path.join(os.homedir(), ".claude");
   },
-  port: parseInt(process.env.PORT || "7331", 10),
+  port: parseInt(process.env.PORT || "4010", 10),
   get projectsDir() {
     return path.join(this.claudeDir, "projects");
   },
@@ -31,7 +31,7 @@ export function loadCompressionConfig(): CompressionConfig {
       10
     ),
     maxAttempts: parseInt(process.env.COMPRESSION_MAX_ATTEMPTS || "4", 10),
-    minTokens: parseInt(process.env.COMPRESSION_MIN_TOKENS || "30", 10),
+    minTokens: parseInt(process.env.COMPRESSION_MIN_TOKENS || "50", 10),
     thinkingThreshold: parseInt(
       process.env.COMPRESSION_THINKING_THRESHOLD || "1000",
       10
diff --git a/src/providers/openrouter-provider.ts b/src/providers/openrouter-provider.ts
index 48eafc0..8d3434d 100644
--- a/src/providers/openrouter-provider.ts
+++ b/src/providers/openrouter-provider.ts
@@ -25,13 +25,13 @@ export class OpenRouterProvider implements LlmProvider {
     }
     this.apiKey = apiKey;
     this.model =
-      process.env.OPENROUTER_MODEL || "google/gemini-3-flash-preview";
+      process.env.OPENROUTER_MODEL || "google/gemini-2.5-flash";
     this.modelLarge =
       process.env.OPENROUTER_MODEL_LARGE || "anthropic/claude-opus-4.5";
   }
 
   /**
-   * Build the compression prompt using the team-bruce template.
+   * Build the compression prompt for Flash (simple, fast).
    */
   private buildPrompt(text: string, level: CompressionLevel): string {
     const targetPercent = level === "compress" ? 35 : 10;
@@ -49,6 +49,37 @@ Rules:
 
 Return exactly one JSON object: {"text": "your compressed text"}
 
+Input text:
+<<<CONTENT
+${text}
+CONTENT`;
+  }
+
+  /**
+   * Build the compression prompt for Opus (with thinking and quality checks).
+   */
+  private buildPromptLarge(text: string, level: CompressionLevel): string {
+    const targetPercent = level === "compress" ? 35 : 10;
+    return `You are TextCompressor. Your task is to compress the text below to approximately ${targetPercent}% of its original length.
+
+Think step by step:
+1. First, identify the key entities, claims, and relationships that must be preserved
+2. Identify redundancy, filler, and hedging that can be removed
+3. Draft a compressed version
+4. Check: Is it approximately ${targetPercent}% of the original length? (tokens â‰ˆ ceil(characters / 4))
+5. Check: Does it preserve all essential meaning?
+6. Revise if needed, then output
+
+Rules:
+- Preserve key entities, claims, and relationships
+- Remove redundancy, filler, and hedging
+- Keep fluent English
+- If unsure about length, err shorter
+- Do not include explanations or commentary outside the JSON
+- Do not reference "I", "we", "user", "assistant", or conversation roles
+
+After your thinking, return exactly one JSON object: {"text": "your compressed text"}
+
 Input text:
 <<<CONTENT
 ${text}
@@ -60,7 +91,7 @@ CONTENT`;
    *
    * @param text - The text to compress
    * @param level - Compression level: "compress" (35%) or "heavy-compress" (10%)
-   * @param useLargeModel - Whether to use the large model for messages >1000 tokens
+   * @param useLargeModel - Whether to use the large model for messages >500 tokens
    * @returns The compressed text
    */
   async compress(
@@ -69,7 +100,20 @@ CONTENT`;
     useLargeModel: boolean
   ): Promise<string> {
     const model = useLargeModel ? this.modelLarge : this.model;
-    const prompt = this.buildPrompt(text, level);
+    const prompt = useLargeModel
+      ? this.buildPromptLarge(text, level)
+      : this.buildPrompt(text, level);
+
+    // Build request body - add extended thinking for Opus
+    const requestBody: Record<string, unknown> = {
+      model,
+      messages: [{ role: "user", content: prompt }],
+    };
+
+    if (useLargeModel) {
+      // Enable extended thinking for Opus
+      requestBody.reasoning = { effort: "high" };
+    }
 
     const response = await fetch(
       "https://openrouter.ai/api/v1/chat/completions",
@@ -81,11 +125,7 @@ CONTENT`;
           "HTTP-Referer": process.env.OPENROUTER_SITE_URL || "",
           "X-Title": process.env.OPENROUTER_SITE_NAME || "coding-agent-manager",
         },
-        body: JSON.stringify({
-          model,
-          messages: [{ role: "user", content: prompt }],
-          reasoning: { effort: "minimal" },
-        }),
+        body: JSON.stringify(requestBody),
       }
     );
 
diff --git a/src/server.ts b/src/server.ts
index 188ed93..3096f4d 100644
--- a/src/server.ts
+++ b/src/server.ts
@@ -60,6 +60,7 @@ const isDirectRun = import.meta.url === `file://${process.argv[1]}` ||
 if (isDirectRun) {
   app.listen(config.port, () => {
     console.log(`Server running at http://localhost:${config.port}`);
+    console.log(`LLM_PROVIDER: ${process.env.LLM_PROVIDER || "(not set, defaulting to openrouter)"}`);
   });
 }
 
diff --git a/src/services/compression-batch.ts b/src/services/compression-batch.ts
index b95fc5a..899ec6b 100644
--- a/src/services/compression-batch.ts
+++ b/src/services/compression-batch.ts
@@ -28,19 +28,21 @@ export async function compressWithTimeout(
     setTimeout(() => reject(new Error("Compression timeout")), task.timeoutMs);
   });
 
+  const startTime = Date.now();
   try {
-    const useLargeModel = task.estimatedTokens > 1000;
+    const useLargeModel = task.estimatedTokens > 500;
     const result = await Promise.race([
       client.compress(task.originalContent, task.level, useLargeModel),
       timeoutPromise,
     ]);
 
-    return { ...task, status: "success", result };
+    return { ...task, status: "success", result, durationMs: Date.now() - startTime };
   } catch (error) {
     return {
       ...task,
       status: "failed",
       error: error instanceof Error ? error.message : "Unknown error",
+      durationMs: Date.now() - startTime,
     };
   }
 }
diff --git a/src/services/compression-debug-logger.ts b/src/services/compression-debug-logger.ts
index 4b0ce60..354f430 100644
--- a/src/services/compression-debug-logger.ts
+++ b/src/services/compression-debug-logger.ts
@@ -92,14 +92,21 @@ export async function writeCompressionDebugLog(
       markdown += `\n**Compression Stats:**\n`;
       markdown += `- Original: ${task.estimatedTokens} tokens\n`;
       markdown += `- Compressed: ${compressedTokens} tokens\n`;
-      markdown += `- Reduction: ${reduction}%\n\n`;
+      markdown += `- Reduction: ${reduction}%\n`;
+      if (task.durationMs !== undefined) {
+        markdown += `- Duration: ${task.durationMs}ms\n`;
+      }
+      markdown += `\n`;
     } else if (task.status === "skipped") {
       markdown += `**Status:** Not Compressed - Below Threshold (${task.estimatedTokens} tokens)\n\n`;
       markdown += `**Content:**\n\`\`\`\n${escapeMarkdown(task.originalContent)}\n\`\`\`\n\n`;
     } else if (task.status === "failed") {
       markdown += `**Status:** Not Compressed - Failed After ${task.attempt} Attempts\n\n`;
-      markdown += `**Error:** \`${task.error ?? "Unknown error"}\`\n\n`;
-      markdown += `**Content:**\n\`\`\`\n${escapeMarkdown(task.originalContent)}\n\`\`\`\n\n`;
+      markdown += `**Error:** \`${task.error ?? "Unknown error"}\`\n`;
+      if (task.durationMs !== undefined) {
+        markdown += `**Duration:** ${task.durationMs}ms\n`;
+      }
+      markdown += `\n**Content:**\n\`\`\`\n${escapeMarkdown(task.originalContent)}\n\`\`\`\n\n`;
     }
 
     markdown += `---\n\n`;
@@ -146,6 +153,13 @@ export async function writeCompressionDebugLog(
   const skipped = tasks.filter((t) => t.status === "skipped").length;
   const failed = tasks.filter((t) => t.status === "failed").length;
 
+  // Calculate timing stats
+  const tasksWithDuration = tasks.filter((t) => t.durationMs !== undefined);
+  const totalDurationMs = tasksWithDuration.reduce((sum, t) => sum + (t.durationMs ?? 0), 0);
+  const avgDurationMs = tasksWithDuration.length > 0
+    ? Math.round(totalDurationMs / tasksWithDuration.length)
+    : 0;
+
   markdown += `## Summary\n\n`;
   markdown += `Total messages in bands: ${tasks.length}\n`;
   markdown += `- Compressed successfully: ${successful}\n`;
@@ -154,6 +168,11 @@ export async function writeCompressionDebugLog(
   if (nonBandMessages.length > 0) {
     markdown += `\nMessages not in any band: ${nonBandMessages.length}\n`;
   }
+  if (tasksWithDuration.length > 0) {
+    markdown += `\n**Timing:**\n`;
+    markdown += `- Total: ${(totalDurationMs / 1000).toFixed(2)}s\n`;
+    markdown += `- Average per call: ${avgDurationMs}ms\n`;
+  }
 
   // Write file
   await mkdir(debugLogDir, { recursive: true });
diff --git a/src/services/compression.ts b/src/services/compression.ts
index 77ac40e..b3883cc 100644
--- a/src/services/compression.ts
+++ b/src/services/compression.ts
@@ -247,6 +247,13 @@ export function calculateStats(
   const reductionPercent =
     originalTokens > 0 ? Math.round((tokensRemoved / originalTokens) * 100) : 0;
 
+  // Calculate timing stats from tasks that have durationMs
+  const tasksWithDuration = completedTasks.filter((t) => t.durationMs !== undefined);
+  const totalDurationMs = tasksWithDuration.reduce((sum, t) => sum + (t.durationMs ?? 0), 0);
+  const avgDurationMs = tasksWithDuration.length > 0
+    ? Math.round(totalDurationMs / tasksWithDuration.length)
+    : 0;
+
   return {
     messagesCompressed: successful.length,
     messagesSkipped: totalEntries - originalTasks.length,
@@ -255,6 +262,8 @@ export function calculateStats(
     compressedTokens,
     tokensRemoved,
     reductionPercent,
+    totalDurationMs: tasksWithDuration.length > 0 ? totalDurationMs : undefined,
+    avgDurationMs: tasksWithDuration.length > 0 ? avgDurationMs : undefined,
   };
 }
 
diff --git a/src/types.ts b/src/types.ts
index 6580d66..1fdf17f 100644
--- a/src/types.ts
+++ b/src/types.ts
@@ -49,6 +49,7 @@ export interface CompressionTask {
   status: "pending" | "success" | "failed" | "skipped";
   result?: string;
   error?: string;
+  durationMs?: number;
 }
 
 export interface TurnBandMapping {
@@ -64,6 +65,8 @@ export interface CompressionStats {
   compressedTokens: number;
   tokensRemoved: number;
   reductionPercent: number;
+  totalDurationMs?: number;
+  avgDurationMs?: number;
 }
 
 export interface CompressionConfig {
-- 
2.49.0

